---
import Layout from "../layouts/Layout.astro";
import Trash from "../components/icons/Trash.astro";
---

<Layout
  title="boveda de cursos"
  description="Pagina de todos los cursos que se encuentran disponibles"
>
  <section class="bg-white p-10 md:p-10 relative">
    <div class="max-w-[1300px] flex flex-col gap-4 mt-30 md:mt-40 m-auto">
      <div class="flex justify-between items-center">
        <samp class="text-2xl md:text-5xl"> Tu carrito</samp>
        <a
          href="#"
          class="text-[12px] md:text-[16px] underline underline-offset-4 hover:text-blue-400 hover:decoration-blue-400 hover:decoration-2"
        >
          Seguir Comprando
        </a>
      </div>
      <div class="item relative overflow-x-auto">
        <table
          class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400 border-b-1 border-black/7"
        >
          <thead
            class="text-xs text-gray-400 uppercase border-b-1 border-black/7"
          >
            <tr>
              <th scope="col" class="py-3">Producto</th>
              <th scope="col" class="py-3 hidden md:table-cell">Cantidad</th>
              <th scope="col" class="py-3 text-right">Total</th>
            </tr>
          </thead>
          <tbody>
            <tr class="">
              <td class="flex py-4 space-x-5">
                <img
                  src="../img/prueba.webp"
                  class="w-20 md:w-30 max-w-full max-h-full"
                  alt=""
                />
                <div class="flex-row">
                  <p>Amazon FBA por Bessy Arteaga</p>
                  <span class="price text-gray-500 font-semibold">12</span>
                  <div class="flex items-center space-x-2">
                    <div class=" border p-1.5 md:hidden">
                      <!-- Botón de menos -->
                      <button
                        class="decreaseBtn inline-flex items-center justify-center p-1 text-sm font-medium size-[18px] text-gray-500 bg-white border border-gray-300 rounded-full focus:outline-none hover:bg-gray-100"
                        type="button"
                      >
                        <span class="sr-only">Decrease</span>
                        <svg
                          class="w-3 h-3"
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 18 2"
                        >
                          <path
                            stroke="currentColor"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M1 1h16"></path>
                        </svg>
                      </button>
                
                      <!-- Input de número -->
                      <input
                        type="number"
                        class="quantityInput appearance-none text-center placeholder:text-center w-8 text-gray-900 text-sm"
                        placeholder="1"
                        required
                        min="1"
                        value="1"
                        style="appearance: textfield; -moz-appearance: textfield;"
                      />
                
                      <!-- Botón de más -->
                      <button
                        class="increaseBtn inline-flex items-center justify-center size-[18px] p-1 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-full focus:outline-none hover:bg-gray-100"
                        type="button"
                      >
                        <span class="sr-only">Increase</span>
                        <svg
                          class="w-3 h-3"
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 18 18"
                        >
                          <path
                            stroke="currentColor"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 1v16M1 9h16"></path>
                        </svg>
                      </button>
                    </div>
                    <Trash
                      class="w-6 h-6 text-gray-500 hover:text-red-500 cursor-pointer md:hidden"
                    />
                  </div>
               
                </div>

                <td class="py-4 content-center hidden md:table-cell">
                  <div class="flex items-center space-x-5">
                    <div class="border p-3">
                      <!-- Botón de menos -->
                      <button
                        class="decreaseBtn inline-flex items-center justify-center p-1 text-sm font-medium h-6 w-6 text-gray-500 bg-white border border-gray-300 rounded-full focus:outline-none hover:bg-gray-100"
                        type="button"
                      >
                        <span class="sr-only">Decrease</span>
                        <svg
                          class="w-3 h-3"
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 18 2"
                        >
                          <path
                            stroke="currentColor"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M1 1h16"></path>
                        </svg>
                      </button>

                      <!-- Input de número -->
                      <input
                        type="number"
                        class="quantityInput appearance-none text-center placeholder:text-center w-8 mx-5 text-gray-900 text-sm"
                        placeholder="1"
                        required
                        min="1"
                        value="1"
                        style="appearance: textfield; -moz-appearance: textfield;"
                      />

                      <!-- Botón de más -->
                      <button
                        class="increaseBtn inline-flex items-center justify-center h-6 w-6 p-1 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-full focus:outline-none hover:bg-gray-100"
                        type="button"
                      >
                        <span class="sr-only">Increase</span>
                        <svg
                          class="w-3 h-3"
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 18 18"
                        >
                          <path
                            stroke="currentColor"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 1v16M1 9h16"></path>
                        </svg>
                      </button>
                    </div>
                    <Trash
                      class="w-6 h-6 text-gray-500 hover:text-red-500 cursor-pointer hidden md:block"
                    />
                  </div>
                </td>
                <td
                  class="itemTotal content-start md:content-center text-gray-900 font-semibold py-4 text-right"
                  >12</td
                >
              </td>
            </tr>
          </tbody>
        </table>
        <div class="flex flex-col items-center md:items-end pt-10">
          <div class="w-full md:w-[40vh] text-center md:text-end space-y-5">
            <p>Total estimado $<span id="grandTotal">0.00</span></p>
            <p class="text-gray-500">
              Impuesto incluido, se te entregara un link con los detalles para
              la descarga de tu curso
            </p>
            <div class="mt-2">
              <button
                type="button"
                class="w-full py-2.5 px-5 text-sm focus:outline-none bg-white rounded-lg border border-black hover:bg-black hover:text-white focus:z-10 focus:ring-4 focus:ring-gray-100"
                >Comprar</button
              >
            </div>
          </div>
        </div>   
      </div>
    </div>
  </section>

  <style>
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
  </style>


<script>
  const updateTotals = () => {
  const items = document.querySelectorAll(".item");
  let grandTotal = 0;

  items.forEach((item) => {
    const price = parseFloat(item.querySelector(".price")?.textContent || 0);
    const quantityInput = item.querySelector(".quantityInput");
    const quantity = quantityInput ? parseInt(quantityInput.value) || 0 : 0;
    const itemTotal = price * quantity;

    const itemTotalEl = item.querySelector(".itemTotal");
    if (itemTotalEl) {
      itemTotalEl.textContent = itemTotal.toFixed(2);
    }

    grandTotal += itemTotal;
  });

  const grandTotalEl = document.getElementById("grandTotal");
  if (grandTotalEl) {
    grandTotalEl.textContent = grandTotal.toFixed(2);
  }
};

  const quantityInputs = document.querySelectorAll(".quantityInput");

  const syncQuantities = (value) => {
    quantityInputs.forEach(input => {
      input.value = value;
    });
    updateTotals();
  };

  document.querySelectorAll(".increaseBtn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const input = btn.previousElementSibling;
      const newVal = parseInt(input.value) + 1;
      syncQuantities(newVal);
    });
  });

  document.querySelectorAll(".decreaseBtn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const input = btn.nextElementSibling;
      const currentVal = parseInt(input.value);
      const newVal = currentVal > 1 ? currentVal - 1 : 1;
      syncQuantities(newVal);
    });
  });

  // También sincroniza cuando se escribe directamente
  quantityInputs.forEach(input => {
    input.addEventListener("input", (e) => {
      const val = parseInt(e.target.value) || 1;
      syncQuantities(val);
    });
  });

  updateTotals(); // inicializar
</script>

</Layout>


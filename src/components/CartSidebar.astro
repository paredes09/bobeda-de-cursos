---
import { getCart } from "../lib/wp.ts";

let cartItems = [];
try {
  cartItems = await getCart();
} catch (error) {
  console.error('Error al cargar carrito:', error);
}
---

<!-- Overlay oscuro -->
<div id="overlay"
  class="hidden fixed inset-0 bg-black/40 z-[90]"
  onclick="closeCart();"></div>

<!-- Sidebar del carrito -->
<div id="cartSidebar"
  class="fixed top-0 right-0 h-full w-72 md:w-96 bg-white shadow-xl translate-x-full transition-transform duration-300 z-[100] flex flex-col p-4 overflow-y-auto">

  <div class="flex justify-between items-center">
    <h2 class="text-lg font-semibold">Carrito de compras</h2>
    <button onclick="closeCart();" class="text-gray-400 hover:text-black text-xl">âœ–</button>
  </div>

  <hr class="my-3" />

  <!-- Contenido del carrito -->
  <div id="cartItems" class="flex flex-col gap-2">
    {
      cartItems.length === 0 ? (
        <p class="text-gray-500">No products in the cart.</p>
      ) : (
        cartItems.map((item: any) => (
          <div class="flex items-center gap-3 p-2 border rounded-lg shadow-sm">
            <img src={item.imageSrc} alt={item.name} class="w-12 h-12 object-cover rounded border" />
            <div class="flex-1">
              <p class="text-sm font-medium">{item.name}</p>
              <p class="text-xs text-gray-500">Cantidad: <b>{item.quantity}</b></p>
            </div>
            <button class="text-gray-400 hover:text-red-500">âœ–</button>
          </div>
        ))
      )
    }
  </div>
</div>

<!-- BotÃ³n global de abrir -->
<button onclick="openCart()" id="cartBtn" class="fixed top-5 right-5 bg-gray-800 text-white px-4 py-2 rounded-full">
  ðŸ›’
  {cartItems.length > 0 && (
    <span class="ml-1 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full">
      {cartItems.length}
    </span>
  )}
</button>

<!-- Scripts embebidos -->
<script class="">
  window.openCart = () => {
    document.getElementById('cartSidebar').classList.remove('translate-x-full');
    document.getElementById('overlay').classList.remove('hidden');
  };

  window.closeCart = () => {
    document.getElementById('cartSidebar').classList.add('translate-x-full');
    document.getElementById('overlay').classList.add('hidden');
  };
</script>
